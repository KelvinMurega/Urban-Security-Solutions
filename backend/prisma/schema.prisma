// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. User Model (Admin & Guards)
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(GUARD)
  phone     String?
  address   String?
  status    String   @default("ACTIVE") // ACTIVE, INACTIVE
  
  // Relations
  siteId    String?
  site      Site?    @relation(fields: [siteId], references: [id])

  shifts    Shift[]
  incidents Incident[]
  reports   ShiftReport[]
  
  // Placeholder for future feature
  leaves    LeaveRequest[] 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 2. Site Model (Locations)
model Site {
  id           String   @id @default(uuid())
  name         String
  address      String
  contactPhone String?
  latitude     Float?
  longitude    Float?
  
  // Relations
  users        User[]
  shifts       Shift[]
  incidents    Incident[]
  reports      ShiftReport[]
}

// 3. Shift Model (Schedule)
model Shift {
  id        String   @id @default(uuid())
  startTime DateTime
  endTime   DateTime
  status    String   @default("SCHEDULED") // SCHEDULED, COMPLETED, MISSED

  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  siteId    String
  site      Site     @relation(fields: [siteId], references: [id])
}

// 4. Incident Model (Emergencies)
model Incident {
  id          String   @id @default(uuid())
  title       String
  description String
  severity    String   @default("LOW") // LOW, MEDIUM, HIGH, CRITICAL
  status      String   @default("OPEN") // OPEN, RESOLVED
  
  resolutionDetails String?  
  resolvedAt        DateTime?
  reportedAt  DateTime @default(now())
  
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  siteId      String
  site        Site     @relation(fields: [siteId], references: [id])
}

// 5. ShiftReport Model (Daily Logs)
model ShiftReport {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())

  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  siteId    String
  site      Site     @relation(fields: [siteId], references: [id])
}

// Placeholder for Leave Requests (to prevent errors if you had this before)
model LeaveRequest {
  id        String   @id @default(uuid())
  reason    String
  status    String   @default("PENDING")
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

enum Role {
  ADMIN
  GUARD
}