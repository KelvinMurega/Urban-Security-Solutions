generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Defined Enums for strict type safety
enum Role {
  ADMIN
  GUARD
}

enum IncidentSeverity {
  
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ShiftStatus {
  SCHEDULED
  ACTIVE
  COMPLETED
  CANCELLED
}

// 2. Hardened User Model
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(GUARD) // Uses the Enum instead of String
  
  // Relations
  managedSites Site[]    @relation("SiteManager")
  assignedShifts Shift[]
  incidents      Incident[]
  reports        Report[]

  // Audit Fields
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true) // Professional practice: Soft deactivation
}

model Site {
  id          String   @id @default(uuid())
  name        String
  address     String
  location    String?
  
  // Relations
  managerId   String?
  manager     User?    @relation("SiteManager", fields: [managerId], references: [id])
  incidents   Incident[]
  shifts      Shift[]

  // Audit Fields
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Incident {
  id          String           @id @default(uuid())
  title       String
  description String
  severity    IncidentSeverity @default(MEDIUM)
  
  // Relations
  userId      String
  user        User             @relation(fields: [userId], references: [id])
  siteId      String
  site        Site             @relation(fields: [siteId], references: [id])

  // Audit Fields
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Shift {
  id          String      @id @default(uuid())
  startTime   DateTime
  endTime     DateTime?
  status      ShiftStatus @default(SCHEDULED)
  
  // Relations
  userId      String
  user        User        @relation(fields: [userId], references: [id])
  siteId      String
  site        Site        @relation(fields: [siteId], references: [id])
  reports     Report[]

  // Audit Fields
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Report {
  id          String   @id @default(uuid())
  content     String
  
  // Relations
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  shiftId     String
  shift       Shift    @relation(fields: [shiftId], references: [id])

  // Audit Fields
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}